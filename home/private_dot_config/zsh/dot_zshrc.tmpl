# ============================================================================
# Path
# ============================================================================

unset PATH
PATH="/usr/local/bin:/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin"
export PATH

{{ if stat (joinPath .homebrew.prefix "/bin/brew") -}}
export PATH="{{ .homebrew.prefix }}/bin:{{ .homebrew.prefix }}/sbin:$PATH"
{{ end -}}

# ============================================================================
# Options
# ============================================================================

export HISTFILE="$XDG_STATE_HOME/zsh/history"
export HISTSIZE=100000
export SAVEHIST=100000

# Misc XDG-friendly configs for common tools (harmless if unused)
export LESSHISTFILE="$XDG_STATE_HOME/less/history"
export NPM_CONFIG_USERCONFIG="$XDG_CONFIG_HOME/npm/config"
export PIP_CONFIG_FILE="$XDG_CONFIG_HOME/pip/pip.conf"
export NODE_REPL_HISTORY="$XDG_STATE_HOME/node/repl_history"
export IPYTHONDIR="$XDG_CONFIG_HOME/ipython"
export CARGO_HOME="$XDG_DATA_HOME/cargo"
export RUSTUP_HOME="$XDG_DATA_HOME/rustup"
export GNUPGHOME="${GNUPGHOME:-$XDG_DATA_HOME/gnupg}"

setopt AUTO_CD                 # `cd` by typing directory name
setopt AUTO_PUSHD PUSHD_SILENT PUSHD_TO_HOME
setopt EXTENDED_GLOB           # powerful globbing
setopt GLOBDOTS                # * matches dotfiles (explicit choice)
setopt INTERACTIVE_COMMENTS    # allow comments on command line
setopt NO_BEEP
setopt COMPLETE_IN_WORD
setopt PROMPT_SUBST
setopt PIPE_FAIL

export EDITOR="nvim"

# ----------------------------------------------------------------------------
# History
# ----------------------------------------------------------------------------

setopt APPEND_HISTORY          # append (not overwrite) on shell exit
setopt INC_APPEND_HISTORY      # write each command as it executes
setopt EXTENDED_HISTORY        # timestamps etc.
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY
unsetopt NOMATCH               # don't error on unmatched globs

# ----------------------------------------------------------------------------
# Keybindings
# ----------------------------------------------------------------------------

# bindkey -e                   # emacs-style (default)
bindkey -v                     # vi-style

# ----------------------------------------------------------------------------
# Completion
# ----------------------------------------------------------------------------

# remove: handled by zimfw
# autoload -Uz compinit
# compinit -d "$XDG_CACHE_HOME/zsh/zcompdump-$ZSH_VERSION"
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path "$XDG_CACHE_HOME/zsh"
zstyle ':completion:*' menu select
zstyle ':completion:*' group-name ''
zstyle ':completion:*:descriptions' format '%F{yellow}%d%f'
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}' 'r:|[._-]=* r:|=*'

# ============================================================================
# Plugins
# ============================================================================

if [[ ! ${ZIM_HOME}/init.zsh -nt ${ZIM_CONFIG_FILE} ]]; then
{{- if eq .chezmoi.os "darwin" }}
    source {{ .homebrew.prefix }}/opt/zimfw/share/zimfw.zsh init
{{- end }}
fi

source ${ZIM_HOME}/init.zsh

{{ if lookPath "mise" -}}
eval "$(mise activate zsh)"
{{- end }}

# ============================================================================
# Aliases
# ============================================================================

{{- if not (stat (joinPath .chezmoi.homeDir ".config/zsh/.zim/modules/zsh-abbr/zsh-abbr.zsh")) }}
alias ll="ls -al"
{{- end }}

alias e="$EDITOR"
